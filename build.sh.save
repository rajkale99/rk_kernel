#!/bin/bash
echo Welcome To Automated Kernel Compiler For smartron
echo By rajkale99

echo Cleaning some old files

make clean
make mrproper
rm -rf /home/raj/rkkernel/srt/output
rm -rf /home/raj/rkkernel/srt/dsm/modules
rm -rf /home/raj/rkkernel/srt/dsm/zImage

echo Cleaned Some Old Crappy Files

export CROSS_COMPILE=/home/raj/toolchain/bin/aarch64-opt-linux-android-

echo Compiler Set Succesfully

mkdir/home/raj/rkkernel/srt/output

echo Setting Compiler To Build For ARM64

export ARCH=arm64
export SUBARCH=arm64
export KBUILD_BUILD_USER="Rajkale99"
export KBUILD_BUILD_HOST="rk_kernel"

echo Picking rk_kernel configs

make -j4 -C  $(pwd) O=output rk_defconfig

echo Compiling awesomeness

make -j4 -C $(pwd) O=output

cp /home/raj/rkkernel/srt/output/arch/arm64/boot/Image.gz-dtb /home/raj/rkkernel/srt/dsm/

mv /home/raj/rkkernel/srt/dsm/Image.gz-dtb /home/raj/rkkernel/srt/dsm/zImage/

cd /home/raj/rkkernel/srt/output

mkdir -p /output/modules

find /home/raj/rkkernel/srt/output -name '*.ko' -exec cp {} modules/ \;

cd /home/taj/rkkernel/srt/output/modules

/home/raj/toolchain/bin/aarch64-opt-linux-android-strip --strip-unneeded *.ko
mkdir pronto
cp -a wlan.ko pronto_wlan.ko
mv pronto_wlan.ko pronto
mv modules/ /home/raj/rkkernel/srt/dsm

echo Building Has Been Completed
